{#
================================================================================
VIEW PATIENT - Patient Details (Read-Only)
================================================================================
Purpose: Display complete patient information in read-only format
Extends: base.html
Features: Personal info, emergency contact, medical info (role-based), visit history
Access: All authenticated users (medical info limited to managers/dentists)
================================================================================
#}
{% extends "base.html" %}

{% block title %}View Patient - Dental Clinic{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header with Action Buttons -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-person"></i> Patient Details</h2>
        <div>
            <!-- Edit Button -->
            <a href="{{ url_for('edit_patient', patient_id=patient.id) }}" class="btn btn-warning">
                <i class="bi bi-pencil"></i> Edit
            </a>
            <!-- Back Button -->
            <a href="{{ url_for('patients') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Patients
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <!-- Personal Information Card -->
            <div class="card shadow mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">Personal Information</h5>
                </div>
                <div class="card-body">
                    <!-- Patient Name -->
                    <div class="row mb-">
                        <div class="col-md-12">
                            <strong>Patient Name:</strong><br>
                            {{ patient.first_name }} {{ patient.last_name }}
                    </div>

                    <!-- Patient ID -->
                        <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Patient ID:</strong><br>
                            #{{ patient.id }}
                        </div>

                    <!-- Phone -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Phone:</strong><br>
                            {{ patient.phone or 'N/A' }}
                    </div>

                    <!-- Gender -->
                        <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Gender:</strong><br>
                            {{ patient.gender or 'N/A' }}
                    </div>

                    <!-- Date of Birth and Age -->
                        <div class="row mb-3">
                        <div class="col-md-3">
                            <strong>Date of Birth:</strong><br>
                            {{ patient.date_of_birth or 'N/A' }}
                        </div>
                        <div class="row mb-3">
                        <div class="col-md-3">
                            <strong>Age:</strong><br>
                            {{ patient.age or 'N/A' }} years
                        </div>

                    <!-- Email -->
                        <div class="row mb-3">
                        <div class="col-md-12">
                            <strong>Email:</strong><br>
                            {{ patient.email or 'N/A' }}
                    </div>

                    <!-- Address -->
                        <div class="row mb-3">
                        <div class="col-12">
                            <strong>Address:</strong><br>
                            {{ patient.address or 'N/A' }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emergency Contact Card -->
            <div class="card shadow mb-4">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">Emergency Contact</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Contact Name:</strong><br>
                            {{ patient.emergency_contact_name or 'N/A' }}
                        </div>
                        <div class="col-md-6">
                            <strong>Contact Phone:</strong><br>
                            {{ patient.emergency_contact_phone or 'N/A' }}
                        </div>
                    </div>
                </div>
            </div>

         <!-- Medical Information Card (Role-Based Access) -->
         {% if current_user.is_owner() or current_user.is_dentist() or current_user.is_admin() %}
            <div class="card shadow mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">Medical Information</h5>
                </div>
                <div class="card-body">
                    <!-- Allergies -->
                    <div class="mb-3">
                        <strong>Allergies:</strong><br>
                        <p class="text-muted">{{ patient.allergies or 'No known allergies' }}</p>
                    </div>

                    <!-- Existing Conditions -->
                    <div>
                        <strong>Existing Condition:</strong><br>
                        <p class="text-muted">{{ patient.existing_condition or 'No known existing condition' }}</p>
                    </div>

                    <!-- Dentist Notes/Diagnosis -->
                     <div>
                        <strong>Dentist Notes/ Diagnosis:</strong><br>
                        <p class="text-muted">{{ patient.dentist_notes or 'No known dentist notes/ diagnosis' }}</p>
                    </div>

                    <!-- Assigned Dentist -->
                     <div>
                        <strong>Assigned Dentist:</strong><br>
                        <p class="text-muted">{{ patient.assigned_dentist or 'No known assigned dentist' }}</p>
                    </div>

                {% else %}
                <!-- Staff: Limited Medical Info View -->
                <div class="mb-3">
                    <label class="form-label">Allergies</label>
                    <div class="medical-info-readonly">{{ 'No known allergies' }}</div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Existing Conditions</label>
                    <div class="medical-info-readonly">{{ 'No known conditions' }}</div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Dentist Notes / Diagnosis</label>
                    <div class="medical-info-readonly">{{ 'No notes' }}</div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Assigned Dentist</label>
                    <div class="medical-info-readonly">{{ 'Not assigned' }}</div>
                </div>
        {% endif %}

        <!-- Visit History Card -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">Visit History</h5>
                </div>
                <div class="card-body">
                    <p><strong>Created:</strong><br>{{ patient.created_at | format_datetime }}</p>
                    <p><strong>Last Updated:</strong><br>{{ patient.updated_at | format_datetime }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
